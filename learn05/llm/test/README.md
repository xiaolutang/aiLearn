# LLMæ¨¡å—å•å…ƒæµ‹è¯•

æœ¬ç›®å½•åŒ…å«æ™ºèƒ½æ•™å­¦åŠ©æ‰‹LLMæ¨¡å—çš„å®Œæ•´å•å…ƒæµ‹è¯•å¥—ä»¶ï¼Œç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ¨¡å—æ­£å¸¸å·¥ä½œã€‚

## ğŸ“ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
test/
â”œâ”€â”€ README.md                          # æµ‹è¯•è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ test_config.py                      # æµ‹è¯•é…ç½®å’Œæ¨¡æ‹Ÿå¯¹è±¡
â”œâ”€â”€ run_tests.py                        # æµ‹è¯•è¿è¡Œå™¨
â”œâ”€â”€ test_suite.py                       # æµ‹è¯•å¥—ä»¶ç®¡ç†
â”œâ”€â”€ test_llm_client.py                  # LLMå®¢æˆ·ç«¯æµ‹è¯•
â”œâ”€â”€ test_database_manager.py            # æ•°æ®åº“ç®¡ç†å™¨æµ‹è¯•
â”œâ”€â”€ test_config_manager.py              # é…ç½®ç®¡ç†å™¨æµ‹è¯•
â”œâ”€â”€ test_cache.py                       # ç¼“å­˜ç³»ç»Ÿæµ‹è¯•
â”œâ”€â”€ test_context_management.py          # ä¸Šä¸‹æ–‡ç®¡ç†æµ‹è¯•
â”œâ”€â”€ test_prompts.py                     # æç¤ºè¯æ¨¡æ¿æµ‹è¯•
â”œâ”€â”€ test_teaching_analysis_agent.py     # æ•™æåˆ†ææ™ºèƒ½ä½“æµ‹è¯•
â”œâ”€â”€ test_learning_status_agent.py       # å­¦æƒ…åˆ†ææ™ºèƒ½ä½“æµ‹è¯•
â”œâ”€â”€ test_tutoring_agent.py              # è¾…å¯¼æ™ºèƒ½ä½“æµ‹è¯•
â”œâ”€â”€ test_classroom_ai_agent.py          # è¯¾å ‚AIæ™ºèƒ½ä½“æµ‹è¯•
â”œâ”€â”€ test_sql_agent.py                   # SQLæ™ºèƒ½ä½“æµ‹è¯•
â”œâ”€â”€ test_langgraph_sql_agent.py         # LangGraph SQLæ™ºèƒ½ä½“æµ‹è¯•
â””â”€â”€ test_agent_manager.py               # æ™ºèƒ½ä½“ç®¡ç†å™¨æµ‹è¯•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨ï¼ˆæ¨èï¼‰
python test/run_tests.py

# æˆ–ä½¿ç”¨Python unittest
python -m unittest discover test/ -v
```

### è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
python test/test_suite.py core

# è¿è¡Œæ™ºèƒ½ä½“æµ‹è¯•
python test/test_suite.py agent

# è¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
python test/test_suite.py quick

# è¿è¡Œå†’çƒŸæµ‹è¯•ï¼ˆåŸºæœ¬åŠŸèƒ½éªŒè¯ï¼‰
python test/test_suite.py smoke
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶

```bash
# è¿è¡ŒLLMå®¢æˆ·ç«¯æµ‹è¯•
python test/run_tests.py -t test_llm_client

# è¿è¡Œæ•°æ®åº“ç®¡ç†å™¨æµ‹è¯•
python test/run_tests.py -t test_database_manager

# è¿è¡Œæ™ºèƒ½ä½“ç®¡ç†å™¨æµ‹è¯•
python test/run_tests.py -t test_agent_manager
```

### è¿è¡Œç‰¹å®šæµ‹è¯•ç±»

```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
python test/run_tests.py -t test_llm_client.TestOpenAIClient

# è¿è¡Œå¤šä¸ªæµ‹è¯•ç±»
python test/run_tests.py -t test_llm_client.TestOpenAIClient test_database_manager.TestDatabaseManager
```

## ğŸ“Š æµ‹è¯•å¥—ä»¶è¯´æ˜

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• (core)
- **LLMå®¢æˆ·ç«¯**: OpenAIã€é€šä¹‰åƒé—®å®¢æˆ·ç«¯åŠå·¥å‚ç±»
- **æ•°æ®åº“ç®¡ç†**: æ•°æ®åº“è¿æ¥ã€æŸ¥è¯¢ã€äº‹åŠ¡ç®¡ç†
- **é…ç½®ç®¡ç†**: é…ç½®åŠ è½½ã€éªŒè¯ã€ç¯å¢ƒå˜é‡å¤„ç†

### æ™ºèƒ½ä½“æµ‹è¯• (agent)
- **æ•™æåˆ†ææ™ºèƒ½ä½“**: æ•™æå†…å®¹è§£æã€çŸ¥è¯†ç‚¹æå–
- **å­¦æƒ…åˆ†ææ™ºèƒ½ä½“**: æˆç»©åˆ†æã€å­¦ä¹ çŠ¶æ€è¯„ä¼°
- **è¾…å¯¼æ™ºèƒ½ä½“**: ä¸ªæ€§åŒ–è¾…å¯¼æ–¹æ¡ˆç”Ÿæˆ
- **è¯¾å ‚AIæ™ºèƒ½ä½“**: å®æ—¶äº’åŠ¨ã€é—®é¢˜å›ç­”
- **SQLæ™ºèƒ½ä½“**: è‡ªç„¶è¯­è¨€è½¬SQLã€æŸ¥è¯¢æ‰§è¡Œ
- **æ™ºèƒ½ä½“ç®¡ç†å™¨**: æ™ºèƒ½ä½“è°ƒåº¦ã€ä»»åŠ¡åˆ†å‘

### å·¥å…·ç±»æµ‹è¯• (utility)
- **ç¼“å­˜ç³»ç»Ÿ**: ç¼“å­˜ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–
- **ä¸Šä¸‹æ–‡ç®¡ç†**: ä¼šè¯ç®¡ç†ã€å¯¹è¯å†å²
- **æç¤ºè¯ç®¡ç†**: æ¨¡æ¿ç®¡ç†ã€åŠ¨æ€ç”Ÿæˆ

### é›†æˆæµ‹è¯• (integration)
- **ç«¯åˆ°ç«¯æµ‹è¯•**: å®Œæ•´ä¸šåŠ¡æµç¨‹éªŒè¯
- **ç»„ä»¶åä½œ**: å¤šç»„ä»¶äº¤äº’æµ‹è¯•
- **æ•°æ®æµæµ‹è¯•**: æ•°æ®åœ¨å„ç»„ä»¶é—´çš„æµè½¬

### æ€§èƒ½æµ‹è¯• (performance)
- **å“åº”æ—¶é—´**: LLMè°ƒç”¨ã€æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- **å¹¶å‘å¤„ç†**: å¤šç”¨æˆ·åŒæ—¶è®¿é—®
- **å†…å­˜ä½¿ç”¨**: å†…å­˜æ³„æ¼æ£€æµ‹

### é”™è¯¯å¤„ç†æµ‹è¯• (error)
- **å¼‚å¸¸å¤„ç†**: å„ç§å¼‚å¸¸æƒ…å†µçš„å¤„ç†
- **å®¹é”™æœºåˆ¶**: æœåŠ¡é™çº§ã€é‡è¯•æœºåˆ¶
- **è¾¹ç•Œæ¡ä»¶**: æç«¯è¾“å…¥çš„å¤„ç†

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

```bash
# ç”ŸæˆHTMLæµ‹è¯•æŠ¥å‘Š
python test/run_tests.py --report test_report.txt

# è¿è¡Œæ€§èƒ½æµ‹è¯•
python test/run_tests.py --performance
```

### è‡ªå®šä¹‰æµ‹è¯•é…ç½®

```bash
# è®¾ç½®è¯¦ç»†è¾“å‡ºçº§åˆ«
python test/run_tests.py -v 2

# ç¦ç”¨å½©è‰²è¾“å‡º
python test/run_tests.py --no-color

# ä½¿ç”¨è‡ªå®šä¹‰æµ‹è¯•æ¨¡å¼
python test/run_tests.py -p "test_agent_*.py"
```

### æŸ¥çœ‹å¯ç”¨æµ‹è¯•å¥—ä»¶

```bash
# åˆ—å‡ºæ‰€æœ‰æµ‹è¯•å¥—ä»¶
python test/test_suite.py -l
```

## ğŸ§ª æµ‹è¯•æ•°æ®è¯´æ˜

### æ¨¡æ‹Ÿæ•°æ®
æµ‹è¯•ä½¿ç”¨ `test_config.py` ä¸­å®šä¹‰çš„æ¨¡æ‹Ÿæ•°æ®ï¼š

- **å­¦ç”Ÿæ•°æ®**: 4ä¸ªæ¨¡æ‹Ÿå­¦ç”Ÿï¼ˆå¼ ä¸‰ã€æå››ã€ç‹äº”ã€èµµå…­ï¼‰
- **æˆç»©æ•°æ®**: å„ç§‘ç›®æˆç»©è®°å½•
- **ç§‘ç›®æ•°æ®**: æ•°å­¦ã€è‹±è¯­ã€ç‰©ç†ã€åŒ–å­¦
- **æ•™ææ•°æ®**: é«˜ä¸­å¿…ä¿®è¯¾ç¨‹å†…å®¹
- **LLMå“åº”**: é¢„è®¾çš„æ™ºèƒ½ä½“å“åº”æ¨¡æ¿

### æ¨¡æ‹Ÿå¯¹è±¡
- **MockLLMClient**: æ¨¡æ‹ŸLLMå®¢æˆ·ç«¯ï¼Œæ”¯æŒä¸åŒå“åº”æ¨¡å¼
- **MockDatabaseManager**: æ¨¡æ‹Ÿæ•°æ®åº“ç®¡ç†å™¨ï¼Œæ”¯æŒCRUDæ“ä½œ
- **MockCacheManager**: æ¨¡æ‹Ÿç¼“å­˜ç®¡ç†å™¨ï¼Œæ”¯æŒç¼“å­˜ç­–ç•¥
- **MockContextManager**: æ¨¡æ‹Ÿä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œæ”¯æŒä¼šè¯ç®¡ç†

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡

### æ ¸å¿ƒç»„ä»¶è¦†ç›–ç‡ç›®æ ‡
- **LLMå®¢æˆ·ç«¯**: 95%+
- **æ•°æ®åº“ç®¡ç†**: 90%+
- **æ™ºèƒ½ä½“**: 85%+
- **å·¥å…·ç±»**: 90%+

### æµ‹è¯•ç±»å‹è¦†ç›–
- âœ… å•å…ƒæµ‹è¯• (Unit Tests)
- âœ… é›†æˆæµ‹è¯• (Integration Tests)
- âœ… æ€§èƒ½æµ‹è¯• (Performance Tests)
- âœ… é”™è¯¯å¤„ç†æµ‹è¯• (Error Handling Tests)
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯• (Edge Case Tests)

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¯¼å…¥é”™è¯¯**
   ```bash
   # ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•è¿è¡Œæµ‹è¯•
   cd /path/to/aiLearn/learn05/service/llm
   python test/run_tests.py
   ```

2. **æ¨¡å—æœªæ‰¾åˆ°**
   ```bash
   # æ£€æŸ¥Pythonè·¯å¾„
   export PYTHONPATH=$PYTHONPATH:/path/to/aiLearn/learn05/service
   ```

3. **æµ‹è¯•å¤±è´¥**
   ```bash
   # è¿è¡Œè¯¦ç»†æ¨¡å¼æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
   python test/run_tests.py -v 2
   ```

4. **æ€§èƒ½æµ‹è¯•è¶…æ—¶**
   ```bash
   # è·³è¿‡æ€§èƒ½æµ‹è¯•
   python test/run_tests.py -t test_llm_client test_database_manager
   ```

### è°ƒè¯•æŠ€å·§

1. **å•ç‹¬è¿è¡Œå¤±è´¥çš„æµ‹è¯•**
   ```bash
   python -m unittest test.test_llm_client.TestOpenAIClient.test_generate_response -v
   ```

2. **ä½¿ç”¨è°ƒè¯•æ¨¡å¼**
   ```python
   import pdb; pdb.set_trace()  # åœ¨æµ‹è¯•ä»£ç ä¸­æ·»åŠ æ–­ç‚¹
   ```

3. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
   ```bash
   export LOG_LEVEL=DEBUG
   python test/run_tests.py
   ```

## ğŸ“ ç¼–å†™æ–°æµ‹è¯•

### æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ
- æµ‹è¯•æ–‡ä»¶ä»¥ `test_` å¼€å¤´
- æµ‹è¯•ç±»ä»¥ `Test` å¼€å¤´
- æµ‹è¯•æ–¹æ³•ä»¥ `test_` å¼€å¤´

### æµ‹è¯•æ¨¡æ¿

```python
import unittest
from test.test_config import (
    TEST_CONFIG, 
    MockLLMClient, 
    MockDatabaseManager,
    create_mock_llm_client,
    assert_response_valid
)

class TestNewFeature(unittest.TestCase):
    """æ–°åŠŸèƒ½æµ‹è¯•"""
    
    def setUp(self):
        """æµ‹è¯•å‰ç½®è®¾ç½®"""
        self.mock_client = create_mock_llm_client()
        
    def tearDown(self):
        """æµ‹è¯•åç½®æ¸…ç†"""
        self.mock_client.reset()
    
    def test_basic_functionality(self):
        """æµ‹è¯•åŸºæœ¬åŠŸèƒ½"""
        # æµ‹è¯•é€»è¾‘
        result = self.mock_client.generate_response("æµ‹è¯•")
        assert_response_valid(result)
        
    def test_error_handling(self):
        """æµ‹è¯•é”™è¯¯å¤„ç†"""
        self.mock_client.set_failure_mode(True)
        with self.assertRaises(Exception):
            self.mock_client.generate_response("é”™è¯¯æµ‹è¯•")

if __name__ == '__main__':
    unittest.main()
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. **æ·»åŠ æ–°æµ‹è¯•**
   - ä¸ºæ–°åŠŸèƒ½ç¼–å†™å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹
   - ç¡®ä¿æµ‹è¯•è¦†ç›–æ­£å¸¸æµç¨‹å’Œå¼‚å¸¸æƒ…å†µ
   - æ›´æ–°æµ‹è¯•å¥—ä»¶é…ç½®

2. **ä¿®æ”¹ç°æœ‰æµ‹è¯•**
   - ä¿æŒæµ‹è¯•çš„ç‹¬ç«‹æ€§å’Œå¯é‡å¤æ€§
   - æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œæ³¨é‡Š
   - ç¡®ä¿æ‰€æœ‰æµ‹è¯•ä»èƒ½é€šè¿‡

3. **æ€§èƒ½ä¼˜åŒ–**
   - é¿å…æµ‹è¯•é—´çš„ç›¸äº’ä¾èµ–
   - ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å‡å°‘å¤–éƒ¨ä¾èµ–
   - åˆç†è®¾ç½®æµ‹è¯•è¶…æ—¶æ—¶é—´

## ğŸ“ æ”¯æŒ

å¦‚æœåœ¨è¿è¡Œæµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥æµ‹è¯•æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
3. ç¡®è®¤ç¯å¢ƒé…ç½®æ˜¯å¦æ­£ç¡®
4. è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒ

---

**æ³¨æ„**: æœ¬æµ‹è¯•å¥—ä»¶è®¾è®¡ç”¨äºå¼€å‘å’ŒCI/CDç¯å¢ƒï¼Œç¡®ä¿LLMæ¨¡å—çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å®šæœŸè¿è¡Œæµ‹è¯•æœ‰åŠ©äºåŠæ—©å‘ç°å’Œä¿®å¤é—®é¢˜ã€‚